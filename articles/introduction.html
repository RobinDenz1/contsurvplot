<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Visualizing the Causal Effect of a Continuous Variable on a Time-To-Event Outcome • contsurvplot</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Visualizing the Causal Effect of a Continuous Variable on a Time-To-Event Outcome">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">contsurvplot</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/introduction.html">Visualizing the Causal Effect of a Continuous Variable on a Time-To-Event Outcome</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/RobinDenz1/contsurvplot/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Visualizing the Causal Effect of a Continuous Variable on a Time-To-Event Outcome</h1>
                        <h4 data-toc-skip class="author">Robin Denz</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/RobinDenz1/contsurvplot/blob/v0.2.2/vignettes/introduction.Rmd" class="external-link"><code>vignettes/introduction.Rmd</code></a></small>
      <div class="d-none name"><code>introduction.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Stratified survival curves are a great way to visualize the effect of
a categorical variable, such as treatment status, on the survival time.
They are easy to produce, easy to understand and (if done correctly)
visually appealing. The situation is slightly more complicated when
confounders exist that need to be accounted for. In this case, methods
that explicitly remove the influence of confounders need to be used to
estimate the curves. Luckily, there are quite a few of those methods and
also associated R-packages that implement them directly, such as the
<code>adjustedCurves</code> package (Denz et al. 2023).</p>
<p>In many cases however, we are not interested in the effect of a
categorical variable. Instead we want to show the effect of a
<em>continuous</em> variable, for example when studying a new biomarker
to predict a certain disease. Currently, there is only a small amount of
research on this topic and even less publicly available code. When
confounder-adjustment is required, the available code and literature is
practically non-existent.</p>
<p>The <code>contsurvplot</code> package tries to fill this gap by
providing multiple types of plots to visualize the causal effect of a
continuous variable on a time-to-event outcome (Denz &amp; Timmesfeld
2023). All plots included rely on a previously fit model that describes
the effect of the target variable on the time-to-event outcome. This
model is then used to perform <em>G-Computation</em> (Robins 1986) to
estimate covariate-level-specific survival curves or cumulative
incidence functions (CIF). By including confounders in the model, all
plots are naturally adjusted for these confounders. In this vignette, we
will showcase the usage of these methods. More details and discussion of
the plots presented here can be found in the paper associated with this
package (Denz &amp; Timmesfeld 2023).</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>The stable release version of this package can be installed directly
from CRAN using:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"contsurvplot"</span><span class="op">)</span></span></code></pre></div>
<p>Alternatively, the developmental version can be installed from
github, using the following code:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"RobinDenz1/contsurvplot"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example-data-and-setup">Example Data and Setup<a class="anchor" aria-label="anchor" href="#example-data-and-setup"></a>
</h2>
<p>First we will load all required packages. This seems like a lot, but
most of them are only required for one plot each.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RobinDenz1/contsurvplot" class="external-link">contsurvplot</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rlang.r-lib.org" class="external-link">rlang</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tagteam/riskRegression" class="external-link">riskRegression</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://adibender.github.io/pammtools/" class="external-link">pammtools</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gganimate.com" class="external-link">gganimate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/thomasp85/transformr" class="external-link">transformr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://plotly-r.com" class="external-link">plotly</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/reshape" class="external-link">reshape2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/rmarkdown" class="external-link">rmarkdown</a></span><span class="op">)</span></span></code></pre></div>
<p>As an example we will utilize the <code>colon</code> dataset included
in the famous <code>survival</code> R-package. It includes data on 1858
patients from a study about treating colon cancer using adjuvant
chemotherapy. We can obtain the <code>colon</code> data by using the
<code><a href="https://rdrr.io/r/utils/data.html" class="external-link">data()</a></code> function. Below are the first few rows of the
dataset:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">cancer</span><span class="op">)</span></span>
<span><span class="va">colon</span><span class="op">$</span><span class="va">sex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">colon</span><span class="op">$</span><span class="va">sex</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">colon</span><span class="op">)</span></span>
<span><span class="co">#&gt;   id study      rx sex age obstruct perfor adhere nodes status differ extent</span></span>
<span><span class="co">#&gt; 1  1     1 Lev+5FU   1  43        0      0      0     5      1      2      3</span></span>
<span><span class="co">#&gt; 2  1     1 Lev+5FU   1  43        0      0      0     5      1      2      3</span></span>
<span><span class="co">#&gt; 3  2     1 Lev+5FU   1  63        0      0      0     1      0      2      3</span></span>
<span><span class="co">#&gt; 4  2     1 Lev+5FU   1  63        0      0      0     1      0      2      3</span></span>
<span><span class="co">#&gt; 5  3     1     Obs   0  71        0      0      1     7      1      2      2</span></span>
<span><span class="co">#&gt; 6  3     1     Obs   0  71        0      0      1     7      1      2      2</span></span>
<span><span class="co">#&gt;   surg node4 time etype</span></span>
<span><span class="co">#&gt; 1    0     1 1521     2</span></span>
<span><span class="co">#&gt; 2    0     1  968     1</span></span>
<span><span class="co">#&gt; 3    0     0 3087     2</span></span>
<span><span class="co">#&gt; 4    0     0 3087     1</span></span>
<span><span class="co">#&gt; 5    0     1  963     2</span></span>
<span><span class="co">#&gt; 6    0     1  542     1</span></span></code></pre></div>
<p>For exemplary purposes, suppose that we are only interested in the
causal effect of the number of lymph nodes with detectable cancer
(column <code>nodes</code>). This is a semi-continuous variable only,
because it is only defined for integers. We will however treat it as a
proper continuous variable here, since it makes no difference for the
examples.</p>
<p>First, we need a model describing the time-to-event outcome in order
to make any plots possible. Here, we will simply use a cox-regression
model, including the covariates <code>age</code>, <code>sex</code> and
<code>nodes</code> as independent variables:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">nodes</span>, data<span class="op">=</span><span class="va">colon</span>, x<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>It is important that we use <code>x=TRUE</code> in the function call,
otherwise it won’t be possible to create the needed estimates. By
including <code>age</code> and <code>sex</code>, we are adjusting all
graphics below for these variables.</p>
<p>By using the standard <code>summary</code> method of the
<code>coxph</code> model object, we can take a look at the estimated
hazard-ratios:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; coxph(formula = Surv(time, status) ~ age + sex + nodes, data = colon, </span></span>
<span><span class="co">#&gt;     x = TRUE)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   n= 1822, number of events= 897 </span></span>
<span><span class="co">#&gt;    (36 observations deleted due to missingness)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;             coef  exp(coef)   se(coef)      z Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; age    0.0004934  1.0004936  0.0028216  0.175    0.861    </span></span>
<span><span class="co">#&gt; sex1  -0.0645554  0.9374842  0.0669405 -0.964    0.335    </span></span>
<span><span class="co">#&gt; nodes  0.0872323  1.0911501  0.0063330 13.774   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;       exp(coef) exp(-coef) lower .95 upper .95</span></span>
<span><span class="co">#&gt; age      1.0005     0.9995    0.9950     1.006</span></span>
<span><span class="co">#&gt; sex1     0.9375     1.0667    0.8222     1.069</span></span>
<span><span class="co">#&gt; nodes    1.0912     0.9165    1.0777     1.105</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Concordance= 0.628  (se = 0.009 )</span></span>
<span><span class="co">#&gt; Likelihood ratio test= 134.1  on 3 df,   p=&lt;2e-16</span></span>
<span><span class="co">#&gt; Wald test            = 191.9  on 3 df,   p=&lt;2e-16</span></span>
<span><span class="co">#&gt; Score (logrank) test = 195.4  on 3 df,   p=&lt;2e-16</span></span></code></pre></div>
<p>We can see that the hazard-ratio of the target variable
<code>nodes</code> is approximately 1.091. Together with a very small
p-value, this indicates that the survival probability of the patients
decreases with a rising number of affected lymph nodes. This is a
plausible (and hardly shocking) result.</p>
<p>But how bad is a hazard-ratio of 1.091 exactly? A trained
statistician might have no problem interpreting this number correctly,
but for many other medical scientists this number might not mean that
much. Appropriate visualizations are the key to proper communication of
such regression results. Because relative effect measures, such as the
hazard-ratio, are inherently harder to interpret than absolute effect
measures, we will only use the latter. This includes the standard
survival probability at time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>.</p>
</div>
<div class="section level2">
<h2 id="how-do-we-get-the-survival-probability-from-the-model">How do We get the Survival Probability from the Model?<a class="anchor" aria-label="anchor" href="#how-do-we-get-the-survival-probability-from-the-model"></a>
</h2>
<p>Internally, all plot functions call the <code>curve_cont</code>
function to perform g-computation in order to obtain survival
probability estimates at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
that would have been observed if all patients had a specific value of
the continuous covariate. Internally, it uses the
<code>predictRisk</code> function from the <code>riskRegression</code>
package to do this (Ozenne et al. 2017). For example, lets look at this
specific function call:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/curve_cont.html">curve_cont</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">colon</span>, variable<span class="op">=</span><span class="st">"nodes"</span>, model<span class="op">=</span><span class="va">model</span>,</span>
<span>           horizon<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">15</span><span class="op">)</span>, times<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">2000</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   time       est cont</span></span>
<span><span class="co">#&gt; 1 1000 0.7244607    0</span></span>
<span><span class="co">#&gt; 2 2000 0.6290340    0</span></span>
<span><span class="co">#&gt; 3 1000 0.4625632   10</span></span>
<span><span class="co">#&gt; 4 2000 0.3299905   10</span></span>
<span><span class="co">#&gt; 5 1000 0.3035407   15</span></span>
<span><span class="co">#&gt; 6 2000 0.1800854   15</span></span></code></pre></div>
<p>Using the previously fit cox-regression model, this function outputs
a single row for each covariate - time combination with an associated
survival time. The first column shows the average survival probability
of all patients at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>1000</mn></mrow><annotation encoding="application/x-tex">t = 1000</annotation></semantics></math>,
if they all had
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0</mn><annotation encoding="application/x-tex">0</annotation></semantics></math>
lymph nodes with detectable cancer. In this case, the probability is
approximately 0.724. Similarly, if all patients would have had 10
affected lymph nodes, the average survival probability would be much
lower at approximately 0.462.</p>
<p>By estimating these probabilities for a wide range of times and
values of the continuous variable, we effectively get a three
dimensional counterfactual survival curve. If the model is correctly
specified, the estimates will be unbiased with an easy causal
interpretation. All that’s left is to visualize them appropriately.</p>
</div>
<div class="section level2">
<h2 id="plots-based-on-summary-statistics">Plots Based on Summary Statistics<a class="anchor" aria-label="anchor" href="#plots-based-on-summary-statistics"></a>
</h2>
<p>There are some plots based on summary statistics of survival curves
as they evolve with the continuous variable. The main idea here is to
reduce the visualization to two dimensions by summarizing the survival
curves at specific values of the variable in one value. This statistic
can then be plotted as a single line.</p>
<div class="section level3">
<h3 id="survival-probability-at-t">Survival Probability at t<a class="anchor" aria-label="anchor" href="#survival-probability-at-t"></a>
</h3>
<p>The simplest of all is to plot the survival probability at a specific
point in time as a function of the continuous variable. This can be done
in the <code>contsurvplot</code> package using the
<code>plot_surv_at_t</code> function. For example, the following graph
can be produced using
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>1000</mn></mrow><annotation encoding="application/x-tex">t = 1000</annotation></semantics></math></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_surv_at_t.html">plot_surv_at_t</a></span><span class="op">(</span>time<span class="op">=</span><span class="st">"time"</span>,</span>
<span>               status<span class="op">=</span><span class="st">"status"</span>,</span>
<span>               variable<span class="op">=</span><span class="st">"nodes"</span>,</span>
<span>               data<span class="op">=</span><span class="va">colon</span>,</span>
<span>               model<span class="op">=</span><span class="va">model</span>,</span>
<span>               t<span class="op">=</span><span class="fl">1000</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
<p>We can make this graph a little more interesting by plotting the
survival probability at multiple points in time at once:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_surv_at_t.html">plot_surv_at_t</a></span><span class="op">(</span>time<span class="op">=</span><span class="st">"time"</span>,</span>
<span>               status<span class="op">=</span><span class="st">"status"</span>,</span>
<span>               variable<span class="op">=</span><span class="st">"nodes"</span>,</span>
<span>               data<span class="op">=</span><span class="va">colon</span>,</span>
<span>               model<span class="op">=</span><span class="va">model</span>,</span>
<span>               t<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">500</span>, <span class="fl">1000</span>, <span class="fl">1500</span>, <span class="fl">2000</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
<p>Although this function is easy to produce and to understand, it lacks
information about the survival probability at all other times not shown.
It is best to use this method only when there are specific (possibly
pre-specified) times of interest.</p>
</div>
<div class="section level3">
<h3 id="survival-time-quantiles">Survival Time Quantiles<a class="anchor" aria-label="anchor" href="#survival-time-quantiles"></a>
</h3>
<p>The same kind of graphic can be produced for survival time quantiles
using the <code>plot_surv_quantiles</code> function. The following plot
shows the effect of the <code>nodes</code> on the most popular survival
time quantile - the median survival time:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_surv_quantiles.html">plot_surv_quantiles</a></span><span class="op">(</span>time<span class="op">=</span><span class="st">"time"</span>,</span>
<span>                    status<span class="op">=</span><span class="st">"status"</span>,</span>
<span>                    variable<span class="op">=</span><span class="st">"nodes"</span>,</span>
<span>                    data<span class="op">=</span><span class="va">colon</span>,</span>
<span>                    model<span class="op">=</span><span class="va">model</span>,</span>
<span>                    p<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-10-1.png" width="672"></p>
<p>We can also use this function to plot multiple survival time
quantiles at once:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_surv_quantiles.html">plot_surv_quantiles</a></span><span class="op">(</span>time<span class="op">=</span><span class="st">"time"</span>,</span>
<span>                    status<span class="op">=</span><span class="st">"status"</span>,</span>
<span>                    variable<span class="op">=</span><span class="st">"nodes"</span>,</span>
<span>                    data<span class="op">=</span><span class="va">colon</span>,</span>
<span>                    model<span class="op">=</span><span class="va">model</span>,</span>
<span>                    p<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-11-1.png" width="672"></p>
<p>While a little more sophisticated, this type of plot shares the same
problem of the plot before it. It is still only one point of the
respective survival curves visualized over the range of the target
variable.</p>
</div>
<div class="section level3">
<h3 id="restricted-mean-survival-time">Restricted Mean Survival Time<a class="anchor" aria-label="anchor" href="#restricted-mean-survival-time"></a>
</h3>
<p>A different kind of statistic is the restricted mean survival time
(RMST). It is defined as the area under the survival curve up to a
specific point
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>
and can be interpreted as the mean survival time of the cohort in the
interval
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">[</mo><mn>0</mn><mo>,</mo><mi>τ</mi><mo stretchy="true" form="postfix">]</mo></mrow><annotation encoding="application/x-tex">[0, \tau]</annotation></semantics></math>.
By taking the whole integral, this statistic technically takes the whole
survival curve in the specific interval into account. However, it is
still dependent on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>.</p>
<p>A graph similar to the ones above, but using the RSMT, can be
produced using the <code>plot_surv_rmst</code> function:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_surv_rmst.html">plot_surv_rmst</a></span><span class="op">(</span>time<span class="op">=</span><span class="st">"time"</span>,</span>
<span>               status<span class="op">=</span><span class="st">"status"</span>,</span>
<span>               variable<span class="op">=</span><span class="st">"nodes"</span>,</span>
<span>               data<span class="op">=</span><span class="va">colon</span>,</span>
<span>               model<span class="op">=</span><span class="va">model</span>,</span>
<span>               tau<span class="op">=</span><span class="fl">1000</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-12-1.png" width="672"></p>
<p>To show how the estimates change with different values of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>,
we can also supply multiple values yet again to produce multiple
curves:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_surv_rmst.html">plot_surv_rmst</a></span><span class="op">(</span>time<span class="op">=</span><span class="st">"time"</span>,</span>
<span>               status<span class="op">=</span><span class="st">"status"</span>,</span>
<span>               variable<span class="op">=</span><span class="st">"nodes"</span>,</span>
<span>               data<span class="op">=</span><span class="va">colon</span>,</span>
<span>               model<span class="op">=</span><span class="va">model</span>,</span>
<span>               tau<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">1000</span>, <span class="fl">2000</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-13-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="restricted-mean-time-lost">Restricted Mean Time Lost<a class="anchor" aria-label="anchor" href="#restricted-mean-time-lost"></a>
</h3>
<p>The restricted mean time lost (RMTL) is very closely related to the
RMST. Instead of integrating the area under the survival curve, the area
under the cumulative incidence function (CIF) is calculated. This can be
useful when there are multiple mutually exclusive event types, in which
case only the cause-specific CIF can be estimated, but not the
cause-specific survival curve.</p>
<p>The <code>plot_surv_rmtl</code> function can be used for this
purpose. It has the same functionality and syntax as the
<code>plot_surv_rmst</code> function, so we will only show one plot with
multiple
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>
values below:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_surv_rmtl.html">plot_surv_rmtl</a></span><span class="op">(</span>time<span class="op">=</span><span class="st">"time"</span>,</span>
<span>               status<span class="op">=</span><span class="st">"status"</span>,</span>
<span>               variable<span class="op">=</span><span class="st">"nodes"</span>,</span>
<span>               data<span class="op">=</span><span class="va">colon</span>,</span>
<span>               model<span class="op">=</span><span class="va">model</span>,</span>
<span>               tau<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">1000</span>, <span class="fl">2000</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-14-1.png" width="672"></p>
<p>Since this is a simple survival case with only one event type, the
equation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>1</mn><mo>−</mo><mi>S</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">F(t) = 1 - S(t)</annotation></semantics></math>
still holds, which is why the curves are simply inverted.</p>
</div>
</div>
<div class="section level2">
<h2 id="plots-showing-the-entire-survival-area">Plots Showing the Entire Survival Area<a class="anchor" aria-label="anchor" href="#plots-showing-the-entire-survival-area"></a>
</h2>
<p>In many cases it makes more sense to plot the entire 3D survival
curve dependent on the continuous variable. There are a few options to
do this. Each of them has different pros and cons, none is a
solve-it-all magic bullet. The choice of plot is highly dependent on the
data at hand.</p>
<div class="section level3">
<h3 id="single-curves">Single Curves<a class="anchor" aria-label="anchor" href="#single-curves"></a>
</h3>
<p>The simplest way to plot the entire survival curve is picking a few
specific values of the variable (in our case a few specific numbers of
affected lymph nodes) and plotting the causal survival curve for each
one. This can be done using the <code>plot_surv_lines</code> function.
Here, we pick a few equally spaced values:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_surv_lines.html">plot_surv_lines</a></span><span class="op">(</span>time<span class="op">=</span><span class="st">"time"</span>,</span>
<span>                status<span class="op">=</span><span class="st">"status"</span>,</span>
<span>                variable<span class="op">=</span><span class="st">"nodes"</span>,</span>
<span>                data<span class="op">=</span><span class="va">colon</span>,</span>
<span>                model<span class="op">=</span><span class="va">model</span>,</span>
<span>                horizon<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span>, <span class="fl">25</span>, <span class="fl">30</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-15-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="survival-area">Survival Area<a class="anchor" aria-label="anchor" href="#survival-area"></a>
</h3>
<p>The single survival curves do however tend to obscure the fact that
there is a continuous transition between the covariate values. One way
to make this a little more explicit is to use the
<code>plot_surv_area</code> function, which is similar, but plots the
area between those single curves as well.</p>
<p>Using the default values, it gives us a continuously colored area for
the whole range of possible lymph node values:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_surv_area.html">plot_surv_area</a></span><span class="op">(</span>time<span class="op">=</span><span class="st">"time"</span>,</span>
<span>               status<span class="op">=</span><span class="st">"status"</span>,</span>
<span>               variable<span class="op">=</span><span class="st">"nodes"</span>,</span>
<span>               data<span class="op">=</span><span class="va">colon</span>,</span>
<span>               model<span class="op">=</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-16-1.png" width="672"></p>
<p>It achieves this by calculating a big amount of variable
(<code>nodes</code>) specific survival curves and filling the area
between them continuously.</p>
<p>We can take a step back and divide the area in discrete bins,
coloring them similarly:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_surv_area.html">plot_surv_area</a></span><span class="op">(</span>time<span class="op">=</span><span class="st">"time"</span>,</span>
<span>               status<span class="op">=</span><span class="st">"status"</span>,</span>
<span>               variable<span class="op">=</span><span class="st">"nodes"</span>,</span>
<span>               data<span class="op">=</span><span class="va">colon</span>,</span>
<span>               model<span class="op">=</span><span class="va">model</span>,</span>
<span>               discrete<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-17-1.png" width="672"></p>
<p>Of course we can change the colors as well. Either by providing
<code>start_color</code> and <code>end_color</code> values for a graded
scale as used above, or by supplying a vector of specific colors using
the <code>custom_color</code> argument. We will show only the first
option here, using a black and white scale with a little fewer bins:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_surv_area.html">plot_surv_area</a></span><span class="op">(</span>time<span class="op">=</span><span class="st">"time"</span>,</span>
<span>               status<span class="op">=</span><span class="st">"status"</span>,</span>
<span>               variable<span class="op">=</span><span class="st">"nodes"</span>,</span>
<span>               data<span class="op">=</span><span class="va">colon</span>,</span>
<span>               model<span class="op">=</span><span class="va">model</span>,</span>
<span>               discrete<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>               bins<span class="op">=</span><span class="fl">5</span>,</span>
<span>               start_color<span class="op">=</span><span class="st">"lightgrey"</span>,</span>
<span>               end_color<span class="op">=</span><span class="st">"black"</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-18-1.png" width="672"></p>
<p>By keeping the x-axis and y-axis as well as the shape of a normal
survival curve, we think that this type of plot is very appropriate in
many situations. It does, however, only work if the effect of the
continuous covariate is linear or at least always monotonically
increasing or decreasing. For example, using the Body-Mass-Index would
not work with this type of plot, as the BMI usually has a curved
relationship on survival.</p>
</div>
<div class="section level3">
<h3 id="survival-heatmap">Survival Heatmap<a class="anchor" aria-label="anchor" href="#survival-heatmap"></a>
</h3>
<p>One way around this is to use a heatmap instead, which can be created
using the <code>plot_surv_heatmap</code> function:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_surv_heatmap.html">plot_surv_heatmap</a></span><span class="op">(</span>time<span class="op">=</span><span class="st">"time"</span>,</span>
<span>                  status<span class="op">=</span><span class="st">"status"</span>,</span>
<span>                  variable<span class="op">=</span><span class="st">"nodes"</span>,</span>
<span>                  data<span class="op">=</span><span class="va">colon</span>,</span>
<span>                  model<span class="op">=</span><span class="va">model</span>,</span>
<span>                  start_color<span class="op">=</span><span class="st">"blue"</span>,</span>
<span>                  end_color<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-19-1.png" width="672"></p>
<p>In this plot the survival time is still on the x-axis, but the
continuous variable (here the lymph nodes) is on the y-axis and the
survival probability at each point is shown using a continuous color
scale. This works well if the variable has a big effect on the survival,
as is the case here. It does however tend to obscure small causal
effects.</p>
<p>As a visual help, we can add some equally spaced contour lines to it
using the <code>contour_lines</code> argument:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_surv_heatmap.html">plot_surv_heatmap</a></span><span class="op">(</span>time<span class="op">=</span><span class="st">"time"</span>,</span>
<span>                  status<span class="op">=</span><span class="st">"status"</span>,</span>
<span>                  variable<span class="op">=</span><span class="st">"nodes"</span>,</span>
<span>                  data<span class="op">=</span><span class="va">colon</span>,</span>
<span>                  model<span class="op">=</span><span class="va">model</span>,</span>
<span>                  contour_lines<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>                  start_color<span class="op">=</span><span class="st">"blue"</span>,</span>
<span>                  end_color<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-20-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="survival-contours">Survival Contours<a class="anchor" aria-label="anchor" href="#survival-contours"></a>
</h3>
<p>We can of course go a step further than the
<code>plot_surv_heatmap</code> and plot an entire contour plot using the
<code>plot_surv_contour</code> function:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_surv_contour.html">plot_surv_contour</a></span><span class="op">(</span>time<span class="op">=</span><span class="st">"time"</span>,</span>
<span>                  status<span class="op">=</span><span class="st">"status"</span>,</span>
<span>                  variable<span class="op">=</span><span class="st">"nodes"</span>,</span>
<span>                  data<span class="op">=</span><span class="va">colon</span>,</span>
<span>                  model<span class="op">=</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-21-1.png" width="672"></p>
<p>We can also change the number of <code>bins</code> here:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_surv_contour.html">plot_surv_contour</a></span><span class="op">(</span>time<span class="op">=</span><span class="st">"time"</span>,</span>
<span>                  status<span class="op">=</span><span class="st">"status"</span>,</span>
<span>                  variable<span class="op">=</span><span class="st">"nodes"</span>,</span>
<span>                  data<span class="op">=</span><span class="va">colon</span>,</span>
<span>                  model<span class="op">=</span><span class="va">model</span>,</span>
<span>                  bins<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-22-1.png" width="672"></p>
<p>This type of plot is preferable to the heatmap in most cases. In case
of a very smooth effect, the simple heatmap might be a better choice
though.</p>
</div>
<div class="section level3">
<h3 id="survival-matrix">Survival Matrix<a class="anchor" aria-label="anchor" href="#survival-matrix"></a>
</h3>
<p>A different version of a heatmap can be created using the
<code>plot_surv_matrix</code> function. Instead of using a smooth area
with color scaling, this type of plot divides the are into rectangles
and displays the average survival probability inside those. It can be
created like this:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_surv_matrix.html">plot_surv_matrix</a></span><span class="op">(</span>time<span class="op">=</span><span class="st">"time"</span>,</span>
<span>                 status<span class="op">=</span><span class="st">"status"</span>,</span>
<span>                 variable<span class="op">=</span><span class="st">"nodes"</span>,</span>
<span>                 data<span class="op">=</span><span class="va">colon</span>,</span>
<span>                 model<span class="op">=</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-23-1.png" width="672"></p>
<p>This type of heatmap is definitely easier to interpret (and arguably
more pretty), but it also swallows up information by only displaying
<em>average</em> survival probabilities in each rectangle. It is
important to check whether the underlying smooth effect is correctly
displayed with the current amount of rectangles and to change the
dimensions of the matrix accordingly.</p>
<p>In this case, using a 10 x 10 matrix seems fine. This is what it
would look like to use only a 5 x 5 matrix:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_surv_matrix.html">plot_surv_matrix</a></span><span class="op">(</span>time<span class="op">=</span><span class="st">"time"</span>,</span>
<span>                 status<span class="op">=</span><span class="st">"status"</span>,</span>
<span>                 variable<span class="op">=</span><span class="st">"nodes"</span>,</span>
<span>                 data<span class="op">=</span><span class="va">colon</span>,</span>
<span>                 model<span class="op">=</span><span class="va">model</span>,</span>
<span>                 n_col<span class="op">=</span><span class="fl">5</span>,</span>
<span>                 n_row<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-24-1.png" width="672"></p>
<p>25 rectangles are clearly not enough in this case.</p>
</div>
<div class="section level3">
<h3 id="survival-3d-surface">Survival 3D Surface<a class="anchor" aria-label="anchor" href="#survival-3d-surface"></a>
</h3>
<p>Although frowned upon by many scientists, it almost feels natural to
use a 3D surface plot here. All plots above are attempts at showing a
three-dimensional surface in a two-dimensional plot using color scales.
Why not actually show the three-dimensional surface directly? We can do
this using the <code>plot_surv_3Dsurface</code> function:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_surv_3Dsurface.html">plot_surv_3Dsurface</a></span><span class="op">(</span>time<span class="op">=</span><span class="st">"time"</span>,</span>
<span>                    status<span class="op">=</span><span class="st">"status"</span>,</span>
<span>                    variable<span class="op">=</span><span class="st">"nodes"</span>,</span>
<span>                    data<span class="op">=</span><span class="va">colon</span>,</span>
<span>                    model<span class="op">=</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-25-1.png" width="672"></p>
<p>In this particular case, the plot is not too bad. But the usual
criticism of 3D plots still holds here. Identifying single points in
this 3D plane is almost impossible. Without being able to rotate this
figure interactively, this seems like a sub-optimal visualization choice
compared to the other plots above.</p>
</div>
</div>
<div class="section level2">
<h2 id="plots-for-digital-use-only">Plots for Digital Use Only<a class="anchor" aria-label="anchor" href="#plots-for-digital-use-only"></a>
</h2>
<p>If we are not forced to put the plot on paper, however, there is no
reason not to use the interactive nature of computers. There are two
implemented methods for interactive survival plots in this package, both
based on the <code>plotly</code> package. Another plot method based on a
simple animation is also implemented.</p>
<div class="section level3">
<h3 id="interactive-3d-surface-plots">Interactive 3D Surface Plots<a class="anchor" aria-label="anchor" href="#interactive-3d-surface-plots"></a>
</h3>
<p>By setting the <code>interactive</code> argument to <code>TRUE</code>
in the <code>plot_surv_3Dsurface</code> plot, we can overcome some
difficulties of the 3D plot shown above:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># NOT RUN, to keep the vignette size reasonable</span></span>
<span><span class="fu"><a href="../reference/plot_surv_3Dsurface.html">plot_surv_3Dsurface</a></span><span class="op">(</span>time<span class="op">=</span><span class="st">"time"</span>,</span>
<span>                    status<span class="op">=</span><span class="st">"status"</span>,</span>
<span>                    variable<span class="op">=</span><span class="st">"nodes"</span>,</span>
<span>                    data<span class="op">=</span><span class="va">colon</span>,</span>
<span>                    model<span class="op">=</span><span class="va">model</span>,</span>
<span>                    interactive<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="using-a-slider">Using a Slider<a class="anchor" aria-label="anchor" href="#using-a-slider"></a>
</h3>
<p>A different way to create an interactive plot is using a slider. On
the first look, this plot looks like a standard survival curve. Until
you notice the slider. It can be used to specify different values of the
continuous variable dynamically. This type of plot can be created using
the <code>plot_surv_animated</code> function, setting the
<code>slider</code> argument to <code>TRUE</code>. For visual clarity,
we also set the <code>horizon</code> argument to some reasonable values
here:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># NOT RUN, to keep the vignette size reasonable</span></span>
<span><span class="fu"><a href="../reference/plot_surv_animated.html">plot_surv_animated</a></span><span class="op">(</span>time<span class="op">=</span><span class="st">"time"</span>,</span>
<span>                   status<span class="op">=</span><span class="st">"status"</span>,</span>
<span>                   variable<span class="op">=</span><span class="st">"nodes"</span>,</span>
<span>                   data<span class="op">=</span><span class="va">colon</span>,</span>
<span>                   model<span class="op">=</span><span class="va">model</span>,</span>
<span>                   slider<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>                   horizon<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">30</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="using-animation">Using Animation<a class="anchor" aria-label="anchor" href="#using-animation"></a>
</h3>
<p>If we don’t want the user to have to do anything, we can also create
the same plot, but making it animated by default. It will cycle through
the covariate values in <code>horizon</code> one at a time at an equal
speed forever, showing what happens to the survival curve.</p>
<p>This type of plot can be created using the
<code>plot_surv_animated</code> function again, but setting
<code>slider=FALSE</code> this time:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># NOT RUN, to keep the vignette size reasonable</span></span>
<span><span class="fu"><a href="../reference/plot_surv_animated.html">plot_surv_animated</a></span><span class="op">(</span>time<span class="op">=</span><span class="st">"time"</span>,</span>
<span>                   status<span class="op">=</span><span class="st">"status"</span>,</span>
<span>                   variable<span class="op">=</span><span class="st">"nodes"</span>,</span>
<span>                   data<span class="op">=</span><span class="va">colon</span>,</span>
<span>                   model<span class="op">=</span><span class="va">model</span>,</span>
<span>                   slider<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>                   horizon<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">30</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="facetting-by-groups">Facetting by Groups<a class="anchor" aria-label="anchor" href="#facetting-by-groups"></a>
</h2>
<p>In some scenarios it might be useful to display the average treatment
effect separately for some subgroups. Most plot functions in this
package support this directly using the <code>group</code> argument. The
grouping variable should be a factor variable that is included as
independent variable in the used <code>model</code>. For example, we
used <code>sex</code> as an independent factor variable here. To obtain
<strong>survival contour plots</strong> conditional on the sex of the
patients, we can use the following code:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_surv_contour.html">plot_surv_contour</a></span><span class="op">(</span>time<span class="op">=</span><span class="st">"time"</span>,</span>
<span>                  status<span class="op">=</span><span class="st">"status"</span>,</span>
<span>                  variable<span class="op">=</span><span class="st">"nodes"</span>,</span>
<span>                  group<span class="op">=</span><span class="st">"sex"</span>,</span>
<span>                  data<span class="op">=</span><span class="va">colon</span>,</span>
<span>                  model<span class="op">=</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-29-1.png" width="672"></p>
<p>This also works for <strong>survival area plots</strong> in exactly
the same way:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_surv_area.html">plot_surv_area</a></span><span class="op">(</span>time<span class="op">=</span><span class="st">"time"</span>,</span>
<span>               status<span class="op">=</span><span class="st">"status"</span>,</span>
<span>               variable<span class="op">=</span><span class="st">"nodes"</span>,</span>
<span>               group<span class="op">=</span><span class="st">"sex"</span>,</span>
<span>               data<span class="op">=</span><span class="va">colon</span>,</span>
<span>               model<span class="op">=</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-30-1.png" width="672"></p>
<p>In this case, the differences are not extremely big because
<code>sex</code> does not have a big effect on the survival time.</p>
</div>
<div class="section level2">
<h2 id="literature">Literature<a class="anchor" aria-label="anchor" href="#literature"></a>
</h2>
<p>Robin Denz, Nina Timmesfeld (2023). “Visualizing the (Causal) Effect
of a Continuous Variable on a Time-To-Event Outcome”. In: Epidemiology
34.5</p>
<p>Robin Denz, Renate Klaaßen-Mielke, and Nina Timmesfeld. A Comparison
of Different Methods to Adjust Survival Curves for Confounders.
Statistics in Medicine (2023) 42:10, pages 1461-1479.</p>
<p>Brice Ozenne, Anne Lyngholm Sorensen, Thomas Scheike, Christian
Torp-Pedersen and Thomas Alexander Gerds. riskRegression: Predicting the
Risk of an Event using Cox Regression Models. The R Journal (2017) 9:2,
pages 440-460.</p>
<p>James Robins. A New Approach to Causal Inference in Mortality Studies
with a Sustained Exposure Period: Application to Control of the Healthy
Worker Survivor Effect. Mathematical Modelling (1986) 7, pages
1393-1512.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Robin Denz.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
